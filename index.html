<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê°€ì¤‘ì¹˜ ë£°ë › ì¶”ì²¨ê¸°</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 30px; }
    canvas { border-radius: 50%; border: 2px solid #333; transition: transform 3s ease-out; }
    button {margin-top: 30px;}
    .arrow {
      position: absolute;
      top: 50%;
      left: 0;
      transform: translateX(-50%) rotate(-45deg);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid red;
      z-index: 10; /* ìº”ë²„ìŠ¤ë³´ë‹¤ ìœ„ë¡œ ì˜¬ë¼ì˜¤ê²Œ ì„¤ì • */
    }
    .container {
      position: relative;
      width: 500px;
      height: 500px;
      margin: 0 auto;
    }
    .results { margin-top: 30px; }
    h3 { margin-bottom: 5px; }
    ul { padding-left: 0; list-style: none; }
    .winner-popup {
      font-size: 28px;
      font-weight: bold;
      color: #d32f2f;
      animation: pop 1s ease-out;
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 999;
    }
    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

  <h2>ì˜ˆíˆ¬ ê°€ì…í•˜ë©´ 100ë§Œì› ì´ë²¤íŠ¸ ë£°ë ›</h2>
  <div style="display: flex; flex-direction: row; gap: 100px; justify-content: center; align-items: center; margin-top: 30px;">
    <div class="containter2">
    <div class="container">
        <div class="arrow"></div>
        <canvas id="wheel" width="500" height="500"></canvas>
        <div id="popup" class="winner-popup" style="display:none;"></div>
    </div>
    <button onclick="startDraw()">ì¶”ì²¨ ì‹œì‘</button>
    </div>
  <div class="results" style="height: 100%;">
    
    <h3>ğŸ‘‘ 2ë“± (10ëª…)</h3><ul id="second"></ul>
    <h3>ğŸ‰ 3ë“± (20ëª…)</h3><ul id="third"></ul>
  </div>
</div>

  <script>
const participants = [
  { name: "ë¥˜*ì˜", tickets: 5 },
  { name: "ì„*ì§„", tickets: 1 },
  { name: "êµ¬*ì •", tickets: 27 },
  { name: "ë°•*í•˜", tickets: 3 },
  { name: "ë‚¨*í˜„", tickets: 1 },
  { name: "ê°•*ê·œ", tickets: 1 },
  { name: "S******", tickets: 1 },
  { name: "ë°•*ìˆ˜", tickets: 1 },
  { name: "ì¡°*ë¦°", tickets: 11 },
  { name: "ì„œ*ì—°", tickets: 1 },
  { name: "ë³€*ì„", tickets: 8 },
  { name: "í•¨*ë¯¸", tickets: 2 },
  { name: "ë³€*ì„ ", tickets: 2 },
  { name: "J******", tickets: 7 },
  { name: "ì¡°*í˜„", tickets: 2 },
  { name: "ê³µ*í˜„", tickets: 2 },
  { name: "l******", tickets: 2 },
  { name: "ê¹€*ì›", tickets: 2 },
  { name: "1*******", tickets: 2 },
  { name: "t****", tickets: 1 },
  { name: "ì¡°*ì„ ", tickets: 2 },
  { name: "ë°•*ë¯¼", tickets: 1 },
  { name: "í•˜*", tickets: 2 },
  { name: "ê¹€*ìš°", tickets: 1 },
  { name: "ì—¼*í›ˆ", tickets: 1 },
  { name: "e****", tickets: 1 },
  { name: "ì´*ì˜", tickets: 1 },
  { name: "ê¹€*ìš°", tickets: 1 },
  { name: "ê¹€*ì‹ ", tickets: 1 },
  { name: "ê¹€*í˜„", tickets: 2 },
  { name: "ì˜*", tickets: 2 },
  { name: "b********", tickets: 2 },
  { name: "ìµœ*ì‹", tickets: 3 },
  { name: "ì´*ì˜", tickets: 2 },
  { name: "í—ˆ*í˜„", tickets: 2 }
];


    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const popup = document.getElementById("popup");
    let ticketPool = [];
    let currentWinners = new Set();
    let rotation = 0;

    function buildTicketPool() {
      ticketPool = [];
      participants.forEach(p => {
        if (!currentWinners.has(p.name)) {
          for (let i = 0; i < p.tickets; i++) {
            ticketPool.push(p.name);
          }
        }
      });
    }

    function drawWheel() {
      ctx.clearRect(0, 0, 500, 500);
      let total = ticketPool.length;
      let counts = {};
      ticketPool.forEach(name => counts[name] = (counts[name] || 0) + 1);
      let uniqueNames = Object.keys(counts);
      let startAngle = 0;
      uniqueNames.forEach((name, i) => {
        const slice = (counts[name] / total) * Math.PI * 2;
        ctx.beginPath();
        ctx.moveTo(250, 250);
        ctx.arc(250, 250, 250, startAngle, startAngle + slice);
        ctx.fillStyle = `hsl(${i * 25}, 70%, 60%)`;
        ctx.fill();
        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(startAngle + slice / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#000";
        ctx.font = "14px sans-serif";
        ctx.fillText(name, 230, 0);
        ctx.restore();
        startAngle += slice;
      });
    }

    function spinOnce(prizeLevel, ulId) {
      return new Promise(resolve => {
        buildTicketPool();
        drawWheel();

        const randIndex = Math.floor(Math.random() * ticketPool.length);
        const chosenName = ticketPool[randIndex];
        let total = ticketPool.length;
        let counts = {};
        ticketPool.forEach(name => counts[name] = (counts[name] || 0) + 1);
        let uniqueNames = Object.keys(counts);

        // Calculate where the chosen name is located in degrees (clockwise from 0)
        let startAngle = 0;
        let chosenAngle = 0;
        for (let name of uniqueNames) {
          const slice = (counts[name] / total) * 360;
          if (name === chosenName) {
            chosenAngle = startAngle + slice / 2;
            break;
          }
          startAngle += slice;
        }

        // ë³´ì •ëœ íšŒì „ ê°ë„: ì„ íƒëœ ì´ë¦„ì´ 180ë„(6ì‹œ ë°©í–¥)ì— ì˜¤ë„ë¡ ì¡°ì •
        const targetAngle = 180;
        const currentRotation = rotation % 360;
        const delta = (360 + targetAngle - chosenAngle - currentRotation) % 360;
        const spinAngle = 360 * 5 + delta;
        rotation += spinAngle;
        canvas.style.transform = `rotate(${rotation}deg)`;

        setTimeout(() => {
          currentWinners.add(chosenName);
          const ul = document.getElementById(ulId);
          const li = document.createElement("li");
          li.textContent = chosenName;
          ul.appendChild(li);

          popup.textContent = `ğŸ‰ ${chosenName} ë‹¹ì²¨!`;
          popup.style.display = 'block';
          setTimeout(() => popup.style.display = 'none', 2000);

          resolve();
        }, 5000);
      });
    }

    async function startDraw() {
      currentWinners = new Set();
      //document.getElementById("first").innerHTML = "";
      document.getElementById("second").innerHTML = "";
      document.getElementById("third").innerHTML = "";
      rotation = 0;

      buildTicketPool();
      drawWheel();

      //await spinOnce("1st", "first");
      for (let i = 0; i < 10; i++) {
        await spinOnce("2nd", "second");
      }
      for (let i = 0; i < 20; i++) {
        await spinOnce("3rd", "third");
      }
    }

    buildTicketPool();
    drawWheel();
  </script>
</body>
</html>
